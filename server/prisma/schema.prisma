// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String        @id @default(uuid())
  name            String
  email           String        @unique
  password        String
  state           State
  profession      Profession
  age             Int           @default(18)
  gender          Gender?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  expenses        Expense[]
  cash            Cash?
  inflows         Inflow[]
  transactions    Transaction[]
  isVerified      Boolean       @default(false)
  verifiedAt      DateTime?
  verificationOtp String?
  budgets         Budget[]
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

model Expense {
  id             String          @id @default(uuid())
  userId         String
  user           User            @relation(fields: [userId], references: [id])
  name           String
  amount         Int
  recoverable    Boolean?        @default(false)
  category       ExpenseCategory
  description    String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  cashRecoveries CashRecovery[]
}

model Cash {
  id         String   @id @default(uuid())
  userId     String   @unique
  user       User     @relation(fields: [userId], references: [id])
  amount     Int
  dailyLimit Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Inflow {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  amount      Int
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Transaction {
  id              String          @id @default(uuid())
  userId          String
  user            User            @relation(fields: [userId], references: [id])
  amount          Int
  transactionType TransactionType
  refId           String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  currentBalance  Int             @default(0)
}

model Budget {
  id        String          @id @default(uuid())
  userId    String
  user      User            @relation(fields: [userId], references: [id])
  amount    Int
  category  ExpenseCategory
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  @@unique([userId, category])
}

model CashRecovery {
  id          String   @id @default(uuid())
  expenseId   String
  expense     Expense  @relation(fields: [expenseId], references: [id])
  description String?
  amount      Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum State {
  ANDHRA_PRADESH
  ARUNACHAL_PRADESH
  ASSAM
  BIHAR
  CHHATTISGARH
  GOA
  GUJARAT
  HARYANA
  HIMACHAL_PRADESH
  JHARKHAND
  KARNATAKA
  KERALA
  MADHYA_PRADESH
  MAHARASHTRA
  MANIPUR
  MEGHALAYA
  MIZORAM
  NAGALAND
  ODISHA
  PUNJAB
  RAJASTHAN
  SIKKIM
  TAMIL_NADU
  TELANGANA
  TRIPURA
  UTTAR_PRADESH
  UTTARAKHAND
  WEST_BENGAL
}

enum Profession {
  STUDENT
  EMPLOYED
  SELF_EMPLOYED
  BUSINESS
  RETIRED
  UNEMPLOYED
}

enum ExpenseCategory {
  EDUCATION
  HEALTH
  TRAVEL
  FOOD
  ENTERTAINMENT
  BILL
  HOUSING
  ELECTRONICS
  CLOTHING
  INVESTS
  MISCELLANEOUS
  OTHER
}

enum TransactionType {
  IN
  OUT
}
